<!DOCTYPE html>
<html lang="zh-tw">
  <head>
    
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Hugo 0.68.0 with theme Tranquilpeak 0.4.7-BETA">
<meta name="author" content="Dai chou">
<meta name="keywords" content="">
<meta name="description" content="Xilinx AXI Verification IP tutorial 前情提要 一般來說開發Xilinx FPGA上的AXI master/slave ip都是透過C/C&#43;&#43; 轉成HLS或是直接撰寫Verilog。透過C/C&#43;&#43; 轉成的HLS可以自己寫簡單的C/C&#43;&#43; 程式作為testbench，驗證結果可以直接看C/C&#43;&#43; testbench的結果而定，Verilog細節、AXI操作等問題Vivado HLS會幫你完全處理(如果這些部份出現問題，你也沒輒了)。但是透過Verilog直接寫成的IP，通常需要CPU還有記憶體界面(eg. mig)之類的進行全系統測試，而獲取波形等資訊需要透過合成ILA在板子上實際測試。這流程十分繁瑣，合成ILA會浪費大量syntesis和implementation時間，而且可以debug的的訊號數量受限於晶片上的block ram以及LUT數量。然而很多人忽略了Xilinx其實提供了AXI verification IP，可以簡單快速撰寫testbench直接進行behavior simulation，這對於縮短演算法邏輯開發的時間有益。
本文主要以 CPU &lt;-&gt; AXI slave &lt;=&gt; AXI master &lt;-&gt; memory此模式為主。
完整文件請看AXI Verification IP v1.0。
AXI Verification IP 簡介 Xilinx AXI Verification IP主要提供的功能為:
  產生AXI master command與資料(可自訂) 產生AXI slave進行資料讀取與回覆(也可以模擬mig記憶體界面) 檢查AXI protocol  而Xilinx AXI Verification IP (VIP)主要有三種模式：
  作為AXI master
  用來測試AXI slave ip
  作為AXI slave">


<meta property="og:description" content="Xilinx AXI Verification IP tutorial 前情提要 一般來說開發Xilinx FPGA上的AXI master/slave ip都是透過C/C&#43;&#43; 轉成HLS或是直接撰寫Verilog。透過C/C&#43;&#43; 轉成的HLS可以自己寫簡單的C/C&#43;&#43; 程式作為testbench，驗證結果可以直接看C/C&#43;&#43; testbench的結果而定，Verilog細節、AXI操作等問題Vivado HLS會幫你完全處理(如果這些部份出現問題，你也沒輒了)。但是透過Verilog直接寫成的IP，通常需要CPU還有記憶體界面(eg. mig)之類的進行全系統測試，而獲取波形等資訊需要透過合成ILA在板子上實際測試。這流程十分繁瑣，合成ILA會浪費大量syntesis和implementation時間，而且可以debug的的訊號數量受限於晶片上的block ram以及LUT數量。然而很多人忽略了Xilinx其實提供了AXI verification IP，可以簡單快速撰寫testbench直接進行behavior simulation，這對於縮短演算法邏輯開發的時間有益。
本文主要以 CPU &lt;-&gt; AXI slave &lt;=&gt; AXI master &lt;-&gt; memory此模式為主。
完整文件請看AXI Verification IP v1.0。
AXI Verification IP 簡介 Xilinx AXI Verification IP主要提供的功能為:
  產生AXI master command與資料(可自訂) 產生AXI slave進行資料讀取與回覆(也可以模擬mig記憶體界面) 檢查AXI protocol  而Xilinx AXI Verification IP (VIP)主要有三種模式：
  作為AXI master
  用來測試AXI slave ip
  作為AXI slave">
<meta property="og:type" content="article">
<meta property="og:title" content="使用Vivado Xilinx AXI verification IP進行AXI ip開發驗證">
<meta name="twitter:title" content="使用Vivado Xilinx AXI verification IP進行AXI ip開發驗證">
<meta property="og:url" content="https://daichou.github.io/posts/vivado-xilinx-axi-verification-ipaxi-ip/">
<meta property="twitter:url" content="https://daichou.github.io/posts/vivado-xilinx-axi-verification-ipaxi-ip/">
<meta property="og:site_name" content="gattaca-ngin">
<meta property="og:description" content="Xilinx AXI Verification IP tutorial 前情提要 一般來說開發Xilinx FPGA上的AXI master/slave ip都是透過C/C&#43;&#43; 轉成HLS或是直接撰寫Verilog。透過C/C&#43;&#43; 轉成的HLS可以自己寫簡單的C/C&#43;&#43; 程式作為testbench，驗證結果可以直接看C/C&#43;&#43; testbench的結果而定，Verilog細節、AXI操作等問題Vivado HLS會幫你完全處理(如果這些部份出現問題，你也沒輒了)。但是透過Verilog直接寫成的IP，通常需要CPU還有記憶體界面(eg. mig)之類的進行全系統測試，而獲取波形等資訊需要透過合成ILA在板子上實際測試。這流程十分繁瑣，合成ILA會浪費大量syntesis和implementation時間，而且可以debug的的訊號數量受限於晶片上的block ram以及LUT數量。然而很多人忽略了Xilinx其實提供了AXI verification IP，可以簡單快速撰寫testbench直接進行behavior simulation，這對於縮短演算法邏輯開發的時間有益。
本文主要以 CPU &lt;-&gt; AXI slave &lt;=&gt; AXI master &lt;-&gt; memory此模式為主。
完整文件請看AXI Verification IP v1.0。
AXI Verification IP 簡介 Xilinx AXI Verification IP主要提供的功能為:
  產生AXI master command與資料(可自訂) 產生AXI slave進行資料讀取與回覆(也可以模擬mig記憶體界面) 檢查AXI protocol  而Xilinx AXI Verification IP (VIP)主要有三種模式：
  作為AXI master
  用來測試AXI slave ip
  作為AXI slave">
<meta name="twitter:description" content="Xilinx AXI Verification IP tutorial 前情提要 一般來說開發Xilinx FPGA上的AXI master/slave ip都是透過C/C&#43;&#43; 轉成HLS或是直接撰寫Verilog。透過C/C&#43;&#43; 轉成的HLS可以自己寫簡單的C/C&#43;&#43; 程式作為testbench，驗證結果可以直接看C/C&#43;&#43; testbench的結果而定，Verilog細節、AXI操作等問題Vivado HLS會幫你完全處理(如果這些部份出現問題，你也沒輒了)。但是透過Verilog直接寫成的IP，通常需要CPU還有記憶體界面(eg. mig)之類的進行全系統測試，而獲取波形等資訊需要透過合成ILA在板子上實際測試。這流程十分繁瑣，合成ILA會浪費大量syntesis和implementation時間，而且可以debug的的訊號數量受限於晶片上的block ram以及LUT數量。然而很多人忽略了Xilinx其實提供了AXI verification IP，可以簡單快速撰寫testbench直接進行behavior simulation，這對於縮短演算法邏輯開發的時間有益。
本文主要以 CPU &lt;-&gt; AXI slave &lt;=&gt; AXI master &lt;-&gt; memory此模式為主。
完整文件請看AXI Verification IP v1.0。
AXI Verification IP 簡介 Xilinx AXI Verification IP主要提供的功能為:
  產生AXI master command與資料(可自訂) 產生AXI slave進行資料讀取與回覆(也可以模擬mig記憶體界面) 檢查AXI protocol  而Xilinx AXI Verification IP (VIP)主要有三種模式：
  作為AXI master
  用來測試AXI slave ip
  作為AXI slave">
<meta property="og:locale" content="en">

  
    <meta property="article:published_time" content="2020-03-22T02:38:00">
  
  
    <meta property="article:modified_time" content="2020-03-22T02:38:00">
  
  
  
  


<meta name="twitter:card" content="summary">











  <meta property="og:image" content="https://www.gravatar.com/avatar/b4129e5955793d76911ddfa9909e0f60?s=640">
  <meta property="twitter:image" content="https://www.gravatar.com/avatar/b4129e5955793d76911ddfa9909e0f60?s=640">


    <title>使用Vivado Xilinx AXI verification IP進行AXI ip開發驗證</title>

    <link rel="icon" href="https://daichou.github.io/favicon.png">
    

    

    <link rel="canonical" href="https://daichou.github.io/posts/vivado-xilinx-axi-verification-ipaxi-ip/">

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.css" integrity="sha256-vuXZ9LGmmwtjqFX1F+EKin1ThZMub58gKULUyf0qECk=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" integrity="sha256-SEa4XYAHihTcEP1f5gARTB2K26Uk8PsndQYHQC1f4jU=" crossorigin="anonymous" />
    
    
    <link rel="stylesheet" href="https://daichou.github.io/css/style-twzjdbqhmnnacqs0pwwdzcdbt8yhv8giawvjqjmyfoqnvazl0dalmnhdkvp7.min.css" />
    
    

    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-161437179-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="1">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://daichou.github.io/">gattaca-ngin</a>
  </div>
  
    
      <a class="header-right-picture "
         href="https://daichou.github.io/#about">
    
    
    
      
        <img class="header-picture" src="https://www.gravatar.com/avatar/b4129e5955793d76911ddfa9909e0f60?s=90" alt="" />
      
    
    </a>
  
</header>

      <nav id="sidebar" data-behavior="1">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://daichou.github.io/#about">
          <img class="sidebar-profile-picture" src="https://www.gravatar.com/avatar/b4129e5955793d76911ddfa9909e0f60?s=110" alt="" />
        </a>
        <h4 class="sidebar-profile-name">Dai chou</h4>
        
          <h5 class="sidebar-profile-bio">A student major in Computer science in National Chiao Tung University.</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://daichou.github.io/posts">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://daichou.github.io/categories">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://daichou.github.io/tags">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://daichou.github.io/archives">
    
      <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
      
      <span class="sidebar-button-desc">Archives</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://daichou.github.io/#about">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/Daichou" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://daichou.github.io/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="1"
        class="
               hasCoverMetaIn
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
            <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title" itemprop="headline">
      使用Vivado Xilinx AXI verification IP進行AXI ip開發驗證
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time itemprop="datePublished" datetime="2020-03-22T02:38:00-07:00">
        
   22, 2020

      </time>
    
    
  </div>

</div>
          
          <div class="post-content markdown" itemprop="articleBody">
            <div class="main-content-wrap">
              <h2 id="xilinx-axi-verification-ip-tutorial">Xilinx AXI Verification IP tutorial</h2>
<h4 id="前情提要">前情提要</h4>
<p>一般來說開發Xilinx FPGA上的AXI master/slave ip都是透過C/C++ 轉成HLS或是直接撰寫Verilog。透過C/C++ 轉成的HLS可以自己寫簡單的C/C++ 程式作為testbench，驗證結果可以直接看C/C++ testbench的結果而定，Verilog細節、AXI操作等問題Vivado HLS會幫你完全處理(如果這些部份出現問題，你也沒輒了)。但是透過Verilog直接寫成的IP，通常需要CPU還有記憶體界面(eg. mig)之類的進行全系統測試，而獲取波形等資訊需要透過合成ILA在板子上實際測試。這流程十分繁瑣，合成ILA會浪費大量syntesis和implementation時間，而且可以debug的的訊號數量受限於晶片上的block ram以及LUT數量。然而很多人忽略了Xilinx其實提供了AXI verification IP，可以簡單快速撰寫testbench直接進行behavior simulation，這對於縮短演算法邏輯開發的時間有益。</p>
<p>本文主要以 CPU &lt;-&gt; AXI slave &lt;=&gt; AXI master &lt;-&gt; memory此模式為主。</p>
<p>完整文件請看<a href="https://www.xilinx.com/support/documentation/ip_documentation/axi_vip/v1_0/pg267-axi-vip.pdf">AXI Verification IP v1.0</a>。</p>
<h4 id="axi-verification-ip-簡介">AXI Verification IP 簡介</h4>
<p>Xilinx AXI Verification IP主要提供的功能為:</p>
<ul>
<li> 產生AXI master command與資料(可自訂)</li>
<li>產生AXI slave進行資料讀取與回覆(也可以模擬mig記憶體界面)</li>
<li>檢查AXI protocol</li>
</ul>
<p>而Xilinx AXI Verification IP (VIP)主要有三種模式：</p>
<ul>
<li>
<p>作為AXI master</p>
</li>
<li>
<p>用來測試AXI slave ip</p>
</li>
<li>
<p>作為AXI slave</p>
</li>
<li>
<p>用來測試AXI master ip</p>
</li>
<li>
<p>作為AXI pass-through </p>
</li>
<li>
<p>(檢查兩個AXI IP之間的通訊)</p>
</li>
</ul>
<p>AXI VIP提供SystemVerilog界面，透過SystemVerilog的OOP包裝一些AXI protocol操作與memory model。讓開發者可以專注在測試策略上。</p>
<h4 id="flow">flow</h4>
<p>tools -&gt; create and Package New IP -&gt; choose Create AXI Peripheral<br>
其他創造ip都按照基本流程。</p>
<p><a href="https://1.bp.blogspot.com/-UjdXcXQCaVE/XncwUQzPWFI/AAAAAAAAHZo/hxdOA8Q_4KcWvI0NKNeqEHhMqBrO0YXvgCLcBGAsYHQ/s1600/DeepinScreenshot_select-area_20200317222544.png"><img src="https://1.bp.blogspot.com/-UjdXcXQCaVE/XncwUQzPWFI/AAAAAAAAHZo/hxdOA8Q_4KcWvI0NKNeqEHhMqBrO0YXvgCLcBGAsYHQ/s640/DeepinScreenshot_select-area_20200317222544.png" alt=""></a></p>
<p><a href="https://1.bp.blogspot.com/-YZceCPw5bsU/XncwUkrt2MI/AAAAAAAAHZs/y8lDIReFk-kbp8MyytGzv8xE5nWQnWYpQCLcBGAsYHQ/s1600/DeepinScreenshot_select-area_20200317222614.png"><img src="https://1.bp.blogspot.com/-YZceCPw5bsU/XncwUkrt2MI/AAAAAAAAHZs/y8lDIReFk-kbp8MyytGzv8xE5nWQnWYpQCLcBGAsYHQ/s640/DeepinScreenshot_select-area_20200317222614.png" alt=""></a></p>
<p><a href="https://1.bp.blogspot.com/-qQGFGJNgCpI/XncwUXEWH9I/AAAAAAAAHZk/nB8nsICwNq8MiE58grov7_rvF5FAXyI1QCLcBGAsYHQ/s1600/DeepinScreenshot_select-area_20200317222629.png"><img src="https://1.bp.blogspot.com/-qQGFGJNgCpI/XncwUXEWH9I/AAAAAAAAHZk/nB8nsICwNq8MiE58grov7_rvF5FAXyI1QCLcBGAsYHQ/s640/DeepinScreenshot_select-area_20200317222629.png" alt=""></a></p>
<p>這邊可以選取Verify Peripheral IP using AXI4 VIP，會建構完整的測試template。</p>
<p><a href="https://1.bp.blogspot.com/-OMqY5LP3wwA/XncwVE3fMBI/AAAAAAAAHZw/ALyC3KU7N9cuI5_I-ow2MYZRFHP3MuptwCLcBGAsYHQ/s1600/DeepinScreenshot_select-area_20200317222648.png"><img src="https://1.bp.blogspot.com/-OMqY5LP3wwA/XncwVE3fMBI/AAAAAAAAHZw/ALyC3KU7N9cuI5_I-ow2MYZRFHP3MuptwCLcBGAsYHQ/s640/DeepinScreenshot_select-area_20200317222648.png" alt=""></a></p>
<p>完成後會產生如下block diagram</p>
<p><a href="https://1.bp.blogspot.com/-MZp2HKmVa70/XncwfFkLuCI/AAAAAAAAHZ0/Yo-2q44Dw00e27fycWn_IC9geJbDul5kACLcBGAsYHQ/s1600/DeepinScreenshot_select-area_20200319173604.png"><img src="https://1.bp.blogspot.com/-MZp2HKmVa70/XncwfFkLuCI/AAAAAAAAHZ0/Yo-2q44Dw00e27fycWn_IC9geJbDul5kACLcBGAsYHQ/s640/DeepinScreenshot_select-area_20200319173604.png" alt=""></a></p>
<p>並且產生以下範例testbench，註解為程式區段用途。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-verilog" data-lang="verilog"><span style="color:#66d9ef">`timescale</span> <span style="color:#ae81ff">1</span>ns <span style="color:#f92672">/</span> <span style="color:#ae81ff">1</span>ps
<span style="color:#66d9ef">`include</span> <span style="color:#e6db74">&#34;my_dma_v1_0_tb_include.svh&#34;</span>
<span style="color:#75715e">// 以下為必要package
</span><span style="color:#75715e"></span><span style="color:#f92672">import</span> axi_vip_pkg::*;
<span style="color:#f92672">import</span> my_dma_v1_0_bfm_1_slave_0_0_pkg::*;
<span style="color:#f92672">import</span> my_dma_v1_0_bfm_1_master_0_0_pkg::*;
 
<span style="color:#66d9ef">module</span> my_dma_v1_0_tb();
 
<span style="color:#75715e">// AXI slave VIP 參數宣告(以下省略部份程式碼)
</span><span style="color:#75715e"></span>xil_axi_uint                            error_cnt <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
xil_axi_uint                            comparison_cnt <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
axi_transaction                         wr_transaction;   
.......
xil_axi_uint                           mst_agent_verbosity <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;  
xil_axi_uint                           slv_agent_verbosity <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;  
<span style="color:#75715e">// AXI Slave VIP with memory model (如果你的ip為AXI master full會自動產生對應VIP)
</span><span style="color:#75715e"></span>my_dma_v1_0_bfm_1_slave_0_0_slv_mem_t          slv_agent_0;
 
<span style="color:#66d9ef">integer</span> result_slave;  
<span style="color:#66d9ef">bit</span> [<span style="color:#ae81ff">31</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] S00_AXI_test_data[<span style="color:#ae81ff">3</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>]; 
 <span style="color:#66d9ef">localparam</span> LC_AXI_BURST_LENGTH <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>; 
 <span style="color:#66d9ef">localparam</span> LC_AXI_DATA_WIDTH <span style="color:#f92672">=</span> <span style="color:#ae81ff">32</span>; 
 
<span style="color:#75715e">// AXI master VIP 參數參數宣告
</span><span style="color:#75715e"></span><span style="color:#66d9ef">integer</span>                                 i; 
<span style="color:#66d9ef">integer</span>                                 j;  
xil_axi_uint                            trans_cnt_before_switch <span style="color:#f92672">=</span> <span style="color:#ae81ff">48</span>;  
xil_axi_uint                            passthrough_cmd_switch_cnt <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;  
......
axi_ready_gen                           arready_gen2;  
xil_axi_payload_byte                    data_mem[xil_axi_ulong];  
<span style="color:#75715e">//AXI master VIP
</span><span style="color:#75715e"></span>my_dma_v1_0_bfm_1_master_0_0_mst_t          mst_agent_0;
<span style="color:#75715e">// Design under test
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">`BD_WRAPPER</span> DUT(
      .ARESETN(reset), 
      .ACLK(clock) 
    ); 
   
<span style="color:#66d9ef">initial</span> <span style="color:#66d9ef">begin</span>
    <span style="color:#75715e">//基本AXI VIP agent初始設定
</span><span style="color:#75715e"></span> slv_agent_0 <span style="color:#f92672">=</span> new(<span style="color:#e6db74">&#34;slave vip agent&#34;</span>,DUT.<span style="color:#66d9ef">`BD_INST_NAME</span>.slave_0.inst.IF);
       slv_agent_0.set_agent_tag(<span style="color:#e6db74">&#34;Slave VIP&#34;</span>);
    slv_agent_0.set_verbosity(slv_agent_verbosity);
    slv_agent_0.start_slave();
    mst_agent_0 <span style="color:#f92672">=</span> new(<span style="color:#e6db74">&#34;master vip agent&#34;</span>,DUT.<span style="color:#66d9ef">`BD_INST_NAME</span>.master_0.inst.IF);<span style="color:#75715e">//ms  
</span><span style="color:#75715e"></span>        mst_agent_0.set_agent_tag(<span style="color:#e6db74">&#34;Master VIP&#34;</span>); 
    mst_agent_0.set_verbosity(mst_agent_verbosity); 
    mst_agent_0.start_master(); 
     $timeformat (<span style="color:#f92672">-</span><span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34; ps&#34;</span>, <span style="color:#ae81ff">1</span>);
  <span style="color:#66d9ef">end</span>
  <span style="color:#66d9ef">initial</span> <span style="color:#66d9ef">begin</span>
    reset <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span><span style="color:#ae81ff">&#39;b0</span>;
    #<span style="color:#ae81ff">100</span>ns;
    reset <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span><span style="color:#ae81ff">&#39;b1</span>;
    <span style="color:#66d9ef">repeat</span> (<span style="color:#ae81ff">5</span>) @(<span style="color:#66d9ef">negedge</span> clock); 
  <span style="color:#66d9ef">end</span>
  <span style="color:#66d9ef">always</span> #<span style="color:#ae81ff">5</span> clock <span style="color:#f92672">&lt;=</span> <span style="color:#f92672">~</span>clock;
  <span style="color:#66d9ef">initial</span> <span style="color:#66d9ef">begin</span>
      S_AXI_TEST ( );
 
    init_0 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    #<span style="color:#ae81ff">200</span>ns;
    init_0 <span style="color:#f92672">=</span><span style="color:#ae81ff">1</span><span style="color:#ae81ff">&#39;b1</span>;
    #<span style="color:#ae81ff">20</span>ns;
    init_0 <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#ae81ff">&#39;b0</span>;
     
      #<span style="color:#ae81ff">1</span>ns;
      $finish;
  <span style="color:#66d9ef">end</span>
  <span style="color:#66d9ef">initial</span> <span style="color:#66d9ef">begin</span>
  #<span style="color:#ae81ff">1</span>;
    <span style="color:#66d9ef">forever</span> <span style="color:#66d9ef">begin</span>
      slv_agent_0.monitor.item_collected_port.get(slv_monitor_transaction);
      slave_moniter_transaction_queue.push_back(slv_monitor_transaction);
      slave_moniter_transaction_queue_size<span style="color:#f92672">++</span>;
    <span style="color:#66d9ef">end</span>
  <span style="color:#66d9ef">end</span>
<span style="color:#75715e">//測試task範例
</span><span style="color:#75715e"></span><span style="color:#66d9ef">task</span> <span style="color:#66d9ef">automatic</span> S_AXI_TEST;  
<span style="color:#66d9ef">begin</span>   
#<span style="color:#ae81ff">1</span>; 
   $display(<span style="color:#e6db74">&#34;Sequential write transfers example similar to  AXI BFM WRITE_BURST method starts&#34;</span>); 
   mtestID <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; 
   mtestADDR <span style="color:#f92672">=</span> <span style="color:#ae81ff">64&#39;h00000000</span>; 
   mtestBurstLength <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; 
   mtestDataSize <span style="color:#f92672">=</span> xil_axi_size_t&#39;(xil_clog2(<span style="color:#ae81ff">32</span><span style="color:#f92672">/</span><span style="color:#ae81ff">8</span>)); 
   mtestBurstType <span style="color:#f92672">=</span> XIL_AXI_BURST_TYPE_INCR;  
   mtestLOCK <span style="color:#f92672">=</span> XIL_AXI_ALOCK_NOLOCK;  
   mtestCacheType <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;  
   mtestProtectionType <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;  
   mtestRegion <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; 
   mtestQOS <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; 
   result_slave <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; 
  mtestWDataL[<span style="color:#ae81ff">31</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">32&#39;h00000001</span>; 
  <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">4</span>;i<span style="color:#f92672">++</span>) <span style="color:#66d9ef">begin</span> 
     S00_AXI_test_data[i] <span style="color:#f92672">&lt;=</span> mtestWDataL[<span style="color:#ae81ff">31</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>];   
   <span style="color:#75715e">//AXI master write transaction
</span><span style="color:#75715e"></span>   mst_agent_0.AXI4LITE_WRITE_BURST( 
   mtestADDR, 
   mtestProtectionType, 
   mtestWDataL, 
   mtestBresp 
   );   
   mtestWDataL[<span style="color:#ae81ff">31</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> mtestWDataL[<span style="color:#ae81ff">31</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>; 
   mtestADDR <span style="color:#f92672">=</span> mtestADDR <span style="color:#f92672">+</span> <span style="color:#ae81ff">64&#39;h4</span>; 
  <span style="color:#66d9ef">end</span> 
 $display(<span style="color:#e6db74">&#34;Sequential write transfers example similar to  AXI BFM WRITE_BURST method completes&#34;</span>); 
 $display(<span style="color:#e6db74">&#34;Sequential read transfers example similar to  AXI BFM READ_BURST method starts&#34;</span>); 
 mtestID <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; 
 mtestADDR <span style="color:#f92672">=</span> <span style="color:#ae81ff">64&#39;h00000000</span>; 
 mtestBurstLength <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; 
 mtestDataSize <span style="color:#f92672">=</span> xil_axi_size_t&#39;(xil_clog2(<span style="color:#ae81ff">32</span><span style="color:#f92672">/</span><span style="color:#ae81ff">8</span>)); 
 mtestBurstType <span style="color:#f92672">=</span> XIL_AXI_BURST_TYPE_INCR;  
 mtestLOCK <span style="color:#f92672">=</span> XIL_AXI_ALOCK_NOLOCK;  
 mtestCacheType <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;  
 mtestProtectionType <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;  
 mtestRegion <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; 
 mtestQOS <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; 
 <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">4</span>;i<span style="color:#f92672">++</span>) <span style="color:#66d9ef">begin</span> 
   <span style="color:#75715e">//AXI master產生read transaction
</span><span style="color:#75715e"></span>   mst_agent_0.AXI4LITE_READ_BURST( 
        mtestADDR, 
        mtestProtectionType, 
        mtestRDataL, 
        mtestRresp 
      ); 
 
  <span style="color:#66d9ef">end</span> 
<span style="color:#66d9ef">endtask</span>  
 
<span style="color:#66d9ef">endmodule</span>

</code></pre></div><ul>
<li>
<p>對於slave agent有兩種model，分別是：</p>
</li>
<li>
<p>&lt;component_name&gt;_slv_t</p>
</li>
<li>
<p>必須自行在user environment(testbecnch)中補上write response與read response(response包含回傳訊息的內容等)</p>
</li>
<li>
<p>&lt;component_name&gt;_slv_mem_t</p>
</li>
<li>
<p>write response與read response會由agent自行處理</p>
</li>
<li>
<p>帶有memory model</p>
</li>
<li>
<p>對於AXI full master的ip，Vivado會預設使用此agent</p>
</li>
</ul>
<h4 id="heading"></h4>
<p>Testbench、AXI VIP與DUT的關係</p>
<p><a href="https://1.bp.blogspot.com/-r3aKB-f2IDw/Xncw6fxRhwI/AAAAAAAAHaE/gLq_o6EOm8UJjo2LYzY94_eFUJMslkUMwCLcBGAsYHQ/s1600/MS_AXI_test_plan.png"><img src="https://1.bp.blogspot.com/-r3aKB-f2IDw/Xncw6fxRhwI/AAAAAAAAHaE/gLq_o6EOm8UJjo2LYzY94_eFUJMslkUMwCLcBGAsYHQ/s640/MS_AXI_test_plan.png" alt=""></a></p>
<p>以此架構產生的目標測試環境如上所示。其中由於AXI VIP slave是使用memory mode，所以Slave write/read driver不需要user自己在testbench中補上處理程序。</p>
<p>在使用memory model版本的AXI VIP，可以透過blackdoor_memory_write與blackdoor_memory_read存取模擬出的data memory，而AXI master則可透過一般AXI transaction進行讀寫。memory model大小取決於AXI data width的定址空間大小。</p>
<p>blackdoor memory read範例:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-verilog" data-lang="verilog">xil_axi_ulong mem_rd_addr <span style="color:#f92672">=</span> <span style="color:#ae81ff">32&#39;h00000000</span>;  
<span style="color:#66d9ef">bit</span> [<span style="color:#ae81ff">32</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] mem_rd_data;  
mem_rd_data <span style="color:#f92672">=</span> slv_agent_0.mem_model.backdoor_memory_read(mem_rd_addr);
</code></pre></div><p>blackdoor memory write範例：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-verilog" data-lang="verilog"><span style="color:#66d9ef">bit</span> [<span style="color:#ae81ff">32</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] wr_data <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;  
xil_axi_ulong wr_addr <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;  
<span style="color:#66d9ef">bit</span> [(<span style="color:#ae81ff">32</span><span style="color:#f92672">/</span><span style="color:#ae81ff">8</span>)<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] wr_strb <span style="color:#f92672">=</span> <span style="color:#ae81ff">4&#39;hf</span>; <span style="color:#75715e">//byte select  
</span><span style="color:#75715e"></span>slv_agent_0.mem_model.backdoor_memory_write(wr_addr,wr_data,wr_strb);
</code></pre></div><p>memory model使用上可以透過以下code將memory給入預設值方便debug:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-verilog" data-lang="verilog">slv_agent_0.mem_model.set_memory_fill_policy(XIL_AXI_MEMORY_FILL_FIXED);  
slv_agent_0.mem_model.set_default_memory_value(<span style="color:#ae81ff">32&#39;hdeadbeef</span>);
</code></pre></div><p>AXI master VIP進行AXI4 lite read/write的讀寫方式可透過:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-verilog" data-lang="verilog">  
xil_axi_ulong                           mtestADDR;  
xil_axi_prot_t                          mtestProtectionType <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span><span style="color:#ae81ff">&#39;b000</span>;  
<span style="color:#66d9ef">bit</span> [<span style="color:#ae81ff">63</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>]                              mtestWDataL;  
<span style="color:#66d9ef">bit</span> [<span style="color:#ae81ff">63</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>]                              mtestRDataL;  
xil_axi_resp_t                          mtestBresp;  
xil_axi_resp_t[<span style="color:#ae81ff">255</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>]                   mtestRresp;  
mst_agent_0.AXI4LITE_WRITE_BURST(  
        mtestADDR,  
        mtestProtectionType,  
        mtestWDataL,  
        mtestBresp);  
mst_agent_0.AXI4LITE_READ_BURST(  
        mtestADDR,  
        mtestProtectionType,  
        mtestRDataL,  
        mtestRresp);          

</code></pre></div><h4 id="示範testbench-code">示範testbench code</h4>
<p>在gist連結中：<a href="https://gist.github.com/Daichou/6b2e0a62bfc4eeb338e7f82fe40f0cc8">https://gist.github.com/Daichou/6b2e0a62bfc4eeb338e7f82fe40f0cc8</a></p>
<h4 id="其他資源">其他資源</h4>
<p>Xilinx AXI VIP很多資訊只能透過從範例code看註解學習，開啟範例的方法為，先建立一個AXI VIP block design，在block diagram中點擊AXI VIP按右鍵然後會跳出選單，選取open IP example design。在該專案根目錄底下的imports就會含有所有範例testbench。</p>
<h4 id="reference">Reference</h4>
<ul>
<li><a href="https://www.xilinx.com/support/documentation/ip_documentation/axi_vip/v1_0/pg267-axi-vip.pdf">AXI Verification IP v1.0</a></li>
<li><a href="https://xilinx-wiki.atlassian.net/wiki/spaces/A/pages/18841614/Validating+a+master+AXI4+interface+using+the+Verification+IP+as+a+slave">Validating a master AXI4 interface using the Verification IP as a slave</a></li>
<li><a href="https://xilinx-wiki.atlassian.net/wiki/spaces/A/pages/18841951/Validating+a+master+AXI4+interface+using+the+Verification+IP+as+a+slave+part+2">Validating a master AXI4 interface using the Verification IP as a slave (part 2)</a></li>
</ul>

              
            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
            
            <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--disabled">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml"></span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://daichou.github.io/posts/verilog-diagram-generator/" data-tooltip="Verilog Diagram generator">
              
                  <span class="hide-xs hide-sm text-small icon-mr"></span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://daichou.github.io/posts/vivado-xilinx-axi-verification-ipaxi-ip/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://daichou.github.io/posts/vivado-xilinx-axi-verification-ipaxi-ip/">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
      
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  
</div>

            
              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2020 Dai chou. 
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="1">
        <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--disabled">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml"></span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://daichou.github.io/posts/verilog-diagram-generator/" data-tooltip="Verilog Diagram generator">
              
                  <span class="hide-xs hide-sm text-small icon-mr"></span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://daichou.github.io/posts/vivado-xilinx-axi-verification-ipaxi-ip/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://daichou.github.io/posts/vivado-xilinx-axi-verification-ipaxi-ip/">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
      
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  
</div>

      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="1">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fdaichou.github.io%2Fposts%2Fvivado-xilinx-axi-verification-ipaxi-ip%2F">
          <i class="fa fa-facebook-official"></i><span>%!(EXTRA string=Facebook)</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=https%3A%2F%2Fdaichou.github.io%2Fposts%2Fvivado-xilinx-axi-verification-ipaxi-ip%2F">
          <i class="fa fa-twitter"></i><span>%!(EXTRA string=Twitter)</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.gravatar.com/avatar/b4129e5955793d76911ddfa9909e0f60?s=110" alt="" />
    
    <h4 id="about-card-name">Dai chou</h4>
    
      <div id="about-card-bio">A student major in Computer science in National Chiao Tung University.</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Student
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Taiwan
      </div>
    
  </div>
</div>

    

    
  
    
      <div id="cover" style="background-image:url('https://daichou.github.io/images/cover.jpg');"></div>
    
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/js/jquery.fancybox.min.js" integrity="sha256-GEAnjcTqVP+vBp3SSc8bEDQqvWAZMiHyUSIorrWwH50=" crossorigin="anonymous"></script>


<script src="https://daichou.github.io/js/script-pcw6v3xilnxydl1vddzazdverrnn9ctynvnxgwho987mfyqkuylcb1nlt.min.js"></script>


<script lang="javascript">
window.onload = updateMinWidth;
window.onresize = updateMinWidth;
document.getElementById("sidebar").addEventListener("transitionend", updateMinWidth);
function updateMinWidth() {
  var sidebar = document.getElementById("sidebar");
  var main = document.getElementById("main");
  main.style.minWidth = "";
  var w1 = getComputedStyle(main).getPropertyValue("min-width");
  var w2 = getComputedStyle(sidebar).getPropertyValue("width");
  var w3 = getComputedStyle(sidebar).getPropertyValue("left");
  main.style.minWidth = `calc(${w1} - ${w2} - ${w3})`;
}
</script>

<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight > code, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>


  
    
  




    
  </body>
</html>

