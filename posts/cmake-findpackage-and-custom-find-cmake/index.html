<!DOCTYPE html>

<html lang="zh-tw">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="format-detection" content="telephone=no"/>

    <title>gattaca-ngin</title>
    
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#FF3DB4">
    <meta name="theme-color" content="#ffffff">

    
    
    
    <link rel="stylesheet" href="https://daichou.github.io/css/main.min.03322cbe6bddfc28e7b17b84bc5446282a510b14b57be3371ba1f68ef1ab9ce8.css"/>

    
    
    

    
    
 
    
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-161437179-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

</head>
    <body>
        
<nav>
  <header>
    <div class="site-title">
        <a href="/">gattaca-ngin</a>
    </div>  
</header>
  <div class="nav-menu">
  
  <a class="color-link nav-link" href="https://daichou.github.io/index.xml" target="_blank" rel="noopener" type="application/rss+xml">RSS</a>
</div>
<footer class="footer">
	<div class="social-icons">
        

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    
    

    
    
    

    

    

    

    

</div>




	<p><a href="https://github.com/kimcc/hugo-theme-noteworthy" target="_blank" rel="noopener">Noteworthy theme</a></p>
	<p><a href="https://gohugo.io" target="_blank" rel="noopener">Built with Hugo</a></p>

	<script src="https://daichou.github.io/js/main.min.fa5c2b23e07b5d9bfad267a52b4b24fdb053e6fb7524993383594926a3ac270c.js" integrity="sha256-+lwrI+B7XZv60melK0sk/bBT5vt1JJkzg1lJJqOsJww="></script>
</footer>
</nav>
        <div id="content" class="content-container">
        
<h1 class="post-title">CMake: find_package and custom find cmake (findXXX.cmake)</h1>
    
    <time>July 14, 2018</time>
    
    <div>
        <p>
        <h2 id="cmake-find_package-and-custom-find-cmake-findxxxcmake">CMake: find_package and custom find cmake (findXXX.cmake)</h2>
<p>我個人覺得這主題寫最好的是這篇，我會建議大家可以看這篇，不要看我寫的XD<br>
<a href="https://gitlab.kitware.com/cmake/community/wikis/doc/tutorials/How-To-Find-Libraries">https://gitlab.kitware.com/cmake/community/wikis/doc/tutorials/How-To-Find-Libraries</a></p>
<h3 id="find_package">find_package</h3>
<p>find_package是CMake中用來找第三方package的command。這command功能是去找到所需第三方package的資訊(版本、include path、library path等)，並將資訊存入定好的variable中。find_package會曲找尋CMakeLists.txt所在資料夾下的FindXXX.cmake，或是cmake本身定義好的FindXXX.cmake，通常系統路徑是/usr/share/cmake/Modules下(Arch Linux是放在/usr/share/cmake-版本號/Modules下)。基本上有名的package都已經被定義好了。若是想要知道有哪些可用可以自行去路徑下找，或是用:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">cmake  --help-module-lists
</code></pre></div><p>查詢。<br>
在CMake中使用find_package通常會使用類似下列參數。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmake" data-lang="cmake">find_package(<span style="color:#e6db74">OpenCV</span> <span style="color:#e6db74">3.4.1</span> <span style="color:#e6db74">REQUIRED</span>)<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p> find_package(package_name version [REQUIRED] [QUIET] )，Version非必要，主要看package敘述。REQUIRED和QUIET主要用於相依性，若package為必要用REQUIRED，若沒找到直接報錯。選擇性用QUIET，通常會用類似下列方式達成選擇性。若沒找到package不會報任何錯誤。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmake" data-lang="cmake">find_package(<span style="color:#e6db74">OpenMP</span>)  <span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>if (<span style="color:#e6db74">OPENMP_FOUND</span>)  <span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    set (<span style="color:#e6db74">CMAKE_C_FLAGS</span> <span style="color:#e6db74">&#34;${CMAKE_C_FLAGS} ${OpenMP_C_FLAGS}&#34;</span>)  <span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    set (<span style="color:#e6db74">CMAKE_CXX_FLAGS</span> <span style="color:#e6db74">&#34;${CMAKE_CXX_FLAGS} ${OpenMP_CXX_FLAGS}&#34;</span>)  <span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>endif()<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>透過find_package 定義的-FOUND判斷是否存在。<br>
find_package通常會定義下列四種變數：</p>
<ul>
<li>
<p>_FOUND : 是否找到</p>
</li>
<li>
<p>_INCLUDE_DIRS or _INCLUDES : include path，類似gcc -I/path</p>
</li>
<li>
<p>_LIBRARIES or _LIBRARIES or _LIBS : link library 類似 gcc -L/path -l library</p>
</li>
<li>
<p>_DEFINITIONS</p>
</li>
</ul>
<p>當有這些參數後，即可透過一般CMake include或link方式使用，例如：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmake" data-lang="cmake">include_directories( <span style="color:#f92672">${</span>OpenCV_INCLUDE_DIRS<span style="color:#f92672">}</span> )  <span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>target_link_libraries (<span style="color:#e6db74">main</span> <span style="color:#f92672">${</span>PCL_LIBRARIES<span style="color:#f92672">}</span> <span style="color:#f92672">${</span>OpenCV_LIBS<span style="color:#f92672">}</span>)<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>等方式使用。</p>
<h3 id="custom-find-cmake-findxxxcmake-find-modules"> custom find cmake (findXXX.cmake) find modules</h3>
<p>若是CMake沒提供modules就要自己寫find modules啦。</p>
<p>依照前面的敘述，可以知道Find modules最重要的就是取得那四種變數的值。下面以我寫的FindRealsense2.cmake為例。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmake" data-lang="cmake">find_package(<span style="color:#e6db74">PkgConfig</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>find_package(<span style="color:#e6db74">PkgConfig</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>if(<span style="color:#f92672">${</span>CMAKE_VERSION<span style="color:#f92672">}</span> <span style="color:#e6db74">VERSION_LESS</span> <span style="color:#e6db74">2.8.2</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    pkg_check_modules(<span style="color:#e6db74">PC_REALSENSE2</span> <span style="color:#e6db74">librealsense2-dev</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>else()<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    pkg_check_modules(<span style="color:#e6db74">PC_REALSENSE2</span> <span style="color:#e6db74">QUIET</span> <span style="color:#e6db74">librealsense2-dev</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>endif()<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span> <span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>set(<span style="color:#e6db74">REALSENSE2_DEFINITIONS</span> <span style="color:#f92672">${</span>PC_REALSENSE2_CFLAGS_OTHER<span style="color:#f92672">}</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span> <span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">#add a hint so that it can find it without the pkg-config
</span><span style="color:#75715e"></span>find_path(<span style="color:#e6db74">REALSENSE2_INCLUDE_DIR</span> <span style="color:#e6db74">rs.hpp</span>
          <span style="color:#e6db74">HINTS</span>
          <span style="color:#f92672">${</span>PC_REALSENSE2_INCLUDEDIR<span style="color:#f92672">}</span>
          <span style="color:#f92672">${</span>PC_REALSENSE2_INCLUDE_DIRS<span style="color:#f92672">}</span>
          <span style="color:#e6db74">PATHS</span>
            <span style="color:#e6db74">&#34;${PROGRAM_FILES}/librealsense2/Include&#34;</span>
            <span style="color:#e6db74">/usr/include</span>
            <span style="color:#e6db74">/usr/include/librealsense2</span>
            <span style="color:#e6db74">/user/include</span>
            <span style="color:#e6db74">/user/include/librealsense2</span>
          <span style="color:#e6db74">PATH_SUFFIXES</span> <span style="color:#e6db74">librealsense2</span>
)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span> <span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>if(<span style="color:#f92672">${</span>CMAKE_CL_64<span style="color:#f92672">}</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    set(<span style="color:#e6db74">REALSENSE2_PATH_SUFFIXES</span> <span style="color:#e6db74">lib64</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>else()<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    set(<span style="color:#e6db74">REALSENSE2_PATH_SUFFIXES</span> <span style="color:#e6db74">lib</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>endif()<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span> <span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">#add a hint so that it can find it without the pkg-config
</span><span style="color:#75715e"></span>find_library(<span style="color:#e6db74">REALSENSE2_LIBRARY</span>
             <span style="color:#e6db74">NAMES</span> <span style="color:#e6db74">librealsense2.so</span>
             <span style="color:#e6db74">HINTS</span>
             <span style="color:#f92672">${</span>PC_REALSENSE2_LIBDIR<span style="color:#f92672">}</span>
             <span style="color:#f92672">${</span>PC_REALSENSE2_LIBRARY_DIRS<span style="color:#f92672">}</span>
             <span style="color:#e6db74">PATHS</span>
               <span style="color:#e6db74">&#34;${PROGRAM_FILES}/librealsense2&#34;</span>
               <span style="color:#e6db74">/usr/lib</span>
               <span style="color:#e6db74">/usr/lib/x86_64-linux-gnu</span>
               <span style="color:#e6db74">/user/lib</span>
)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span> <span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>set(<span style="color:#e6db74">REALSENSE2_INCLUDE_DIRS</span> <span style="color:#f92672">${</span>REALSENSE2_INCLUDE_DIR<span style="color:#f92672">}</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>set(<span style="color:#e6db74">REALSENSE2_LIBRARIES</span> <span style="color:#f92672">${</span>REALSENSE2_LIBRARY<span style="color:#f92672">}</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span> <span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>include(<span style="color:#e6db74">FindPackageHandleStandardArgs</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>find_package_handle_standard_args(<span style="color:#e6db74">librealsense2</span> <span style="color:#e6db74">DEFAULT_MSG</span>
    <span style="color:#e6db74">REALSENSE2_LIBRARY</span> <span style="color:#e6db74">REALSENSE2_INCLUDE_DIR</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span> <span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>mark_as_advanced(<span style="color:#e6db74">REALSENSE2_LIBRARY</span> <span style="color:#e6db74">REALSENSE2_INCLUDE_DIR</span>)<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>其中最值得關注的是find_path和find_library這兩個command。顧名思義，find_path是拿來找include path的，而find_library則是拿來找shared library location的。find_path主要格式如下(詳情見<a href="https://cmake.org/cmake/help/latest/command/find_path.html">find_path</a>)：</p>
<blockquote>
<p>find_path(<br>
&lt;VAR&gt;<br>
name | NAMES include_folder_or_file_name<br>
[HINTS path1 path2 &hellip;]<br>
[PATHS path1 path2 &hellip;]<br>
[PATH_SUFFIXS suffix1 suffix2]<br>
)</p>
</blockquote>
<p>其中&lt;VAR&gt;即為XXX-INCLUDE_DIR，name可以是header name，比較特殊的是HINTS和PATHS，HINTS與PATHS最大差別是，HINTS會依照系統現有的變數去推測路徑，PATHS則是直接寫死路徑。PATH_SUFFIXS是路徑後綴，例如說rs.hpp實際上在Ubuntu 16.04的路徑是/usr/include/x86_64-linux-gnu/librealsense2/rs.hpp，而前面我們寫的路徑只有/usr/include/x86_64-linux-gnu，這時她會自動加上librealsense2這後綴到路徑中。PATH_SUFFIXS可以用來處理不同Linux distribution路徑放置的習慣問題(有些會像這個例子一樣把librealsense2的東西放入librealsense2中)，若有多個cmake 會都try try看。<br>
另一個類似的command是find_library(詳細在這<a href="https://cmake.org/cmake/help/latest/command/find_library.html">find_library</a>)：</p>
<blockquote>
<p>find_library(<br>
&lt;VAR&gt;<br>
name | NAMES libraries_name<br>
[HINTS path1 path2 &hellip;]<br>
[PATHS path1 path2 &hellip;]<br>
[PATH_SUFFIXS suffix1 suffix2]<br>
)</p>
</blockquote>
<p>其中&lt;VAR&gt;即為XXX-LIBRARIES，其他欄位都和find_path一樣。而XXX-FOUND，則當find_path或是find_library都找不到東西實設為NOT-FOUND。</p>
<p>這個範例裡還有兩個好用東西值得一提，一是pkg_check_modules，這其實是pkg-config的再包裝，以前找opencv的library的時候很常用：</p>
<blockquote>
<p>$ pkg-config opencv &ndash;libs<br>
-lopencv_stitching -lopencv_superres -lopencv_videostab -lopencv_aruco &hellip;&hellip;.</p>
</blockquote>
<p>cmake中的pkg-config功能也差不多，她會幫你找到所需的library放入指定的var中。如下：</p>
<blockquote>
<p> pkg_check_modules(PC_REALSENSE2 librealsense2-dev)</p>
</blockquote>
<p> 這裡是用pkg_check_modules先依照package manager裡有的資訊尋找路徑，產生variable放入HINTS中。</p>
<p>另一個好用的東西是mark_as_advanced，這command會將該變數設為最高級別，當使用ccmake時不需要開啟advanced mode即可看到的變數。</p>
<p>CMake跟automake之類的比起來算是蠻方便的。</p>

        </p>
    </div>
    

    <div class="page-footer">
        
        <hr class="footer-divider">
        
            <a class="tag" href="/tags/cmake">#CMake</a>
        
            <a class="tag" href="/tags/note">#Note</a>
        
      
    </div>


        
        </div>
        <footer class="footer-mobile">
	<div class="social-icons">
        

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    
    

    
    
    

    

    

    

    

</div>




	<div class="footer-mobile-links">
		<p><a href="https://github.com/kimcc/hugo-theme-noteworthy" target="_blank" rel="noopener">Noteworthy theme</a></p>
		<span class="divider-bar">|</span>
		<p><a href="https://gohugo.io" target="_blank" rel="noopener">Built with Hugo</a></p>
	</div>

	<script src="https://daichou.github.io/js/main.min.fa5c2b23e07b5d9bfad267a52b4b24fdb053e6fb7524993383594926a3ac270c.js" integrity="sha256-+lwrI+B7XZv60melK0sk/bBT5vt1JJkzg1lJJqOsJww="></script>
</footer>
    </body>
</html>